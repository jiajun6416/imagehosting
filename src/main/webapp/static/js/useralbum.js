if($(".album_fixed").length){var ow=$(".album").innerWidth();var lockrelist=false;function relist(){if(!lockrelist){var num=Math.floor($(".album").innerWidth()/ $(".album_i").outerWidth());var fn=num- $(".album_i").length%num;$(".album_i_fixed").remove();if(fn<num){var ndc='';for(;fn>0;fn--)
ndc+='<span class="album_i_fixed"></span> ';$(".album_fixed").before(ndc);}}}
var st;$(window).resize(function(){var nw=$(".album").width();if(ow!=nw){ow=nw;if(st)
clearTimeout(st);st=setTimeout("relist();",100);}});relist();$(window).scroll(function(){if(isScrollBottom()&&!$(".scrollshowtips").length){}
backTop();});var slwait=false,p=2;function scrollload(){if(!slwait){$.ajax({beforeSend:function(){slwait=true;$(".album").scrollshowtips("show");},complete:function(){slwait=false;$(".album").scrollshowtips("remove");},cache:false,data:{"p":p},dataType:"json",error:function(){$(".album").scrollshowtips("fail");},success:function(result){if($.isArray(result.album)){lockrelist=true;p++;$(".album").scrollshowtips("removeall");var ndc='';$.each(result.album,function(i,album){ndc+='<span class="album_i">';ndc+='<a href="'+ album.link+'" onclick="window.location.href=this.href;return false;">';ndc+='<span class="album_i_a">'+ album.img+'</span>';ndc+='<span class="album_i_b">'+ album.name+'</span>';ndc+='</a>';ndc+='<span class="album_i_c">';ndc+='<span class="album_i_c_a">共'+ album.photonum+'张图片</span>';ndc+='<span class="album_i_c_b"><label'+(album.purview=='所有人可见'?'':' class="cog"')+'>'+ album.purview+'</label>'+ album.func+'</span>';ndc+='</span>';ndc+='</span> ';});if($(".album_i_fixed").length)
$(".album_i_fixed").first().before(ndc);else
$(".album_fixed").before(ndc);lockrelist=false;relist();}else
$(".album").scrollshowtips("null");}});}}}
function createalbum(){$.dialog.showFuncLayer(500,'创建相册 (相册数量最大上限100个)','<form id="createalbumform" action="" method="post" onsubmit="return false;">'+'<div class="editalbum_i">'+'<span class="editalbum_i_a">相册名称：</span>'+'<span class="editalbum_i_b"><input type="text" name="name" maxlength="20" class="editalbum_i_b_i" value="" /></span><span class="editalbum_i_c"><label title="选择公开后，相册可以给任何人查看" style="padding-right:50px;"><input type="checkbox" name="albumtype" value="1">公开相册</label>相册名称长度为3到20个字符</span>'+'</div>'+'<div class="clear"></div>'+'</form>',function(){var name=$("#createalbumform input[name='name']").val();var albumtype=$("#createalbumform input[name='albumtype']:checked").val();if(!name.length)
$.alert.show("相册名称长度为3到20个字符！");else{$.ajax({beforeSend:function(){editwait=true;$.prompt.show('正在提交......')},complete:function(){editwait=false;$.prompt.hidden()},cache:false,data:{'name':name,'albumtype':albumtype?albumtype:0},error:function(){$.dialog.showMsgLayer('系统异常','对不起，系统出现异常，相册创建失败！');},success:function(result){if(result.code==1){$.alert.show(result.msg,function(){window.location.reload();});}else{$.alert.show(result.msg);return false;}},type:'POST',url:'/?m=Home&c=User&a=creat_album_ajax'});}});}
function showalbums(type,obj){$('.tabbtn').removeClass('hover');$(obj).addClass('hover');var boxs=$('.album_i');boxs.each(function(i){$(this).hide();$('.album_i[data-type='+type+']').show();});}
var editwait=false;function editalbum(obj,dom,qs,as,atype){var opv=$(dom).parents('.album_i_c').find('.album_i_c_b label').html();var ov=$(dom).parents('.album_i').find('.album_i_b').html().replace(/"/g,'&quot;');var pis=' style="display:none;"';var ckd=' checked="checked"';var prc=['','',''];if("所有人可见"===opv)
prc[0]=ckd;else if("仅自己可见"===opv)
prc[2]=ckd;else{pis='';prc[1]=ckd;}
if(atype==1){var albumtypebox='<label title="选择公开后，相册可以给任何人查看" style="padding-right:50px;"><input type="checkbox" name="albumtype" value="1" checked>公开相册</label>';}else{var albumtypebox='<label title="选择公开后，相册可以给任何人查看" style="padding-right:50px;"><input type="checkbox" name="albumtype" value="1">公开相册</label>';}
$.dialog.showFuncLayer(500,'编辑相册 (相册数量最大上限100个)','<form id="editalbumform" action="" method="post" onsubmit="return false;">'+'<div class="editalbum_i">'+'<span class="editalbum_i_a">相册名称：</span>'+'<span class="editalbum_i_b"><input type="text" name="name" maxlength="20" class="editalbum_i_b_i" value="'+ ov+'" /><input type="hidden" name="aid" value="'+obj+'"></span>'+'<span class="editalbum_i_c">'+albumtypebox+'相册名称长度为3到20个字符</span>'+'</div>'+'<div class="clear"></div>'+'</form>',function(){var name=$("#editalbumform input[name='name']").val();var purview=$("#editalbumform input[name='purview']:checked").val();var question=$("#editalbumform input[name='question']").val();var answer=$("#editalbumform input[name='answer']").val();var albumtype=$("#editalbumform input[name='albumtype']:checked").val();if(!name.length)
$.alert.show("请输入相册名称！");else{var gonext=true;if(purview==''){gonext=false;if(!question.length)
$.alert.show("请输入问题！");else if(question.length>30)
$.alert.show("问题最长30字！");else if(!answer.length)
$.alert.show("请输入答案！");else if(answer.length>20)
$.alert.show("答案最长20字！");else
gonext=true}
if(gonext){if(!editwait){$.ajax({beforeSend:function(){editwait=true;$.prompt.show('正在提交编辑信息......')},complete:function(){editwait=false;$.prompt.hidden()},cache:false,data:{'aid':$('.editalbum_i_b input[name="aid"]').val(),'name':$('.editalbum_i_b input[name="name"]').val(),'albumtype':albumtype?albumtype:0},error:function(){$.dialog.showMsgLayer('系统异常','对不起，系统出现异常，相册编辑失败！');},success:function(result){if("mgc"==result){$.alert.show("相册名称中包含敏感词，请修改！");}else if(result=="had"){$.alert.show('已存在同名相册，请更改名称！');}else{if(result=="1"){$.dialog.showMsgFuncLayer("成功","修改成功",function(){window.location.reload()},1);}else if(result=="ok"){}else if(result=="unsignin"){$.dialog.showMsgFuncLayer("登录失效","登录已失效，请重新登录！",function(){showSignIn();},1);}else if(result=="ulock"){$.dialog.showMsgFuncLayer('账户锁定','你的账户被锁定了，不能完成操作！');}else{$.dialog.showMsgFuncLayer('编辑失败','无变化');}}},type:'POST',url:'/?m=Home&c=User&a=edit_album_ajax'});}}}});}
var delwait=false;function delalbum(obj,dom){var num=parseInt($(dom).parents('.album_i_c').find('.album_i_c_a').text());if(num>0)
$.dialog.showMsgLayer("不能删除","此相册下还有图片的么，不能删哦！");else{var ov=$(dom).parents('.album_i').find('.album_i_b').html().replace(/"/g,'&quot;');$.dialog.showFuncLayer(430,"确认删除",'确定要删除相册<span class="cog">“'+ ov+'”</span>吗？',function(){if(!delwait){$.ajax({beforeSend:function(){delwait=true;$.prompt.show('正在删除......')},complete:function(){delwait=false;$.prompt.hidden()},cache:false,data:{'aid':obj},error:function(){$.dialog.showMsgLayer('系统异常','对不起，系统出现异常，删除失败！');},success:function(result){if("unsignin"==result){$.dialog.showMsgFuncLayer("登录失效","登录已失效，请重新登录！",function(){showSignIn();},1);}else if("ok"==result){$(dom).parents(".album_i").hide();$.dialog.hidden();}else if('nytp'==result){$.dialog.showMsgLayer("删除失败","相册内有照片，无法删除！");}else if('one'==result){$.dialog.showMsgLayer("删除失败","至少要留一个相册");}else{$.dialog.showMsgLayer("删除失败","删除失败了！");}},type:'POST',url:'/?m=Home&c=User&a=del_album_ajax'});}});}}
function setalbumlock(type,aid){var setwait=false;if(type=='0'){var ov='设置为<span class="cog">仅自己可见</span>，你确定吗？</span>';}else{var ov='设置为<span class="cog">公开</span>，你确定吗？</span>';}
$.dialog.showFuncLayer(430,"设置相册属性",ov,function(){if(!setwait){$.ajax({beforeSend:function(){setwait=true;$.prompt.show('操作进行中...')},complete:function(){setwait=false;$.prompt.hidden()},cache:false,data:{'aid':aid,'type':type},error:function(){$.dialog.showMsgLayer('系统异常','对不起，系统出现异常，设置失败！');},success:function(result){if("1"==result.code){$.dialog.showMsgFuncLayer("提示",result.info,function(){window.location.reload();});}else{$.dialog.showMsgLayer("提示",result.info);}},type:'POST',url:'/?m=Home&c=User&a=set_album_lock'});}});}