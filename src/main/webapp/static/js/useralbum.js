if ($(".album_fixed").length) {    var ow = $(".album").innerWidth();    var lockrelist = false;    function relist() {        if (!lockrelist) {            var num = Math.floor($(".album").innerWidth() / $(".album_i").outerWidth());            var fn = num - $(".album_i").length % num;            $(".album_i_fixed").remove();            if (fn < num) {                var ndc = '';                for (; fn > 0; fn--) ndc += '<span class="album_i_fixed"></span> ';                $(".album_fixed").before(ndc);            }        }    }    var st;    $(window).resize(function() {        var nw = $(".album").width();        if (ow != nw) {            ow = nw;            if (st) clearTimeout(st);            st = setTimeout("relist();", 100);        }    });    relist();    $(window).scroll(function() {        if (isScrollBottom() && !$(".scrollshowtips").length) {}        backTop();    });    var slwait = false,    p = 2;    function scrollload() {        if (!slwait) {            $.ajax({                beforeSend: function() {                    slwait = true;                    $(".album").scrollshowtips("show");                },                complete: function() {                    slwait = false;                    $(".album").scrollshowtips("remove");                },                cache: false,                data: {                    "p": p                },                dataType: "json",                error: function() {                    $(".album").scrollshowtips("fail");                },                success: function(result) {                    if ($.isArray(result.album)) {                        lockrelist = true;                        p++;                        $(".album").scrollshowtips("removeall");                        var ndc = '';                        $.each(result.album,                        function(i, album) {                            ndc += '<span class="album_i">';                            ndc += '<a href="' + album.link + '" onclick="window.location.href=this.href;return false;">';                            ndc += '<span class="album_i_a">' + album.img + '</span>';                            ndc += '<span class="album_i_b">' + album.name + '</span>';                            ndc += '</a>';                            ndc += '<span class="album_i_c">';                            ndc += '<span class="album_i_c_a">共' + album.photonum + '张图片</span>';                            ndc += '<span class="album_i_c_b"><label' + (album.purview == '所有人可见' ? '': ' class="cog"') + '>' + album.purview + '</label>' + album.func + '</span>';                            ndc += '</span>';                            ndc += '</span> ';                        });                        if ($(".album_i_fixed").length) $(".album_i_fixed").first().before(ndc);                        else $(".album_fixed").before(ndc);                        lockrelist = false;                        relist();                    } else $(".album").scrollshowtips("null");                }            });        }    }}function updatenum(obj, aId) {	$.prompt.show('更新中...');	$.ajax({		type:"POST",		url: basePath+"album/updateNum",		data: {"albumId":aId},		dataType: "json",		cache: false,		success: function(result) {			var code = result.code;			if(code == 200) {				$.prompt.hidden();				$(obj).prev().text(result.data);				} else if(code == 403) {        		$.dialog.showMsgFuncLayer("登录失效", "登录已失效，请重新登录！",        				function() {        			showSignIn();        		},        		1);							} else {				 $.dialog.showMsgFuncLayer(result.message);			}		},        error: function() {            $.dialog.showMsgLayer('系统异常', '对不起，系统出现异常！');        }	})}function createalbum() {    $.dialog.showFuncLayer(500, '创建相册 (相册数量最大上限100个)', '<form id="createalbumform" action="" method="post" onsubmit="return false;">' + '<div class="editalbum_i">' + '<span class="editalbum_i_a">相册名称：</span>' + '<span class="editalbum_i_b"><input type="text" name="name" maxlength="20" class="editalbum_i_b_i" value="" /></span><span class="editalbum_i_c"><label title="选择公开后，相册可以给任何人查看" style="padding-right:50px;"><input type="checkbox" name="albumtype" value="1">公开相册</label>相册名称长度为3到20个字符</span>' + '</div>' + '<div class="clear"></div>' + '</form>',    function() {        var name = $("#createalbumform input[name='name']").val();        var albumtype = $("#createalbumform input[name='albumtype']:checked").val();        if (!name.length)         	$.alert.show("相册名称长度为3到20个字符！");        else {            $.ajax({                beforeSend: function() {                    editwait = true;                    $.prompt.show('正在提交......')                },                complete: function() {                    editwait = false;                    $.prompt.hidden()                },                cache: false,                data: {                    'name': name,                    'albumtype': albumtype ? albumtype: 0                },                error: function() {                    $.dialog.showMsgLayer('系统异常', '对不起，系统出现异常，相册创建失败！');                },                success: function(result) {                    if (result.code == 200) {                        $.alert.show('创建成功',                        function() {                            window.location.reload();                        });                    } else if(result.code == 403) {                		$.dialog.showMsgFuncLayer("登录失效", "登录已失效，请重新登录！",                				function() {                			showSignIn();                		},                		1);                 	                    } else {                        $.alert.show(result.message);                        return false;                    }                },                type: 'POST',                url: basePath+'createAblumn'            });        }    });}function showalbums(type, obj) {    $('.tabbtn').removeClass('hover');    $(obj).addClass('hover');    var boxs = $('.album_i');    boxs.each(function(i) {        $(this).hide();        $('.album_i[data-type=' + type + ']').show();    });}var editwait = false;function editalbum(obj, dom,atype) {    var opv = $(dom).parents('.album_i_c').find('.album_i_c_b label').html();    var ov = $(dom).parents('.album_i').find('.album_i_b').html().replace(/"/g, '&quot;');    var pis = ' style="display:none;"';    var ckd = ' checked="checked"';    var prc = ['', '', ''];    if ("所有人可见" === opv) prc[0] = ckd;    else if ("仅自己可见" === opv) prc[2] = ckd;    else {        pis = '';        prc[1] = ckd;    }    if (atype) {        var albumtypebox = '<label title="选择公开后，相册可以给任何人查看" style="padding-right:50px;"><input type="checkbox" name="albumtype" value="1" checked>公开相册</label>';    } else {        var albumtypebox = '<label title="选择公开后，相册可以给任何人查看" style="padding-right:50px;"><input type="checkbox" name="albumtype" value="1">公开相册</label>';    }    $.dialog.showFuncLayer(500, '编辑相册 (相册数量最大上限100个)', '<form id="editalbumform" action="" method="post" onsubmit="return false;">' + '<div class="editalbum_i">' + '<span class="editalbum_i_a">相册名称：</span>' + '<span class="editalbum_i_b"><input type="text" name="name" maxlength="20" class="editalbum_i_b_i" value="' + ov + '" /><input type="hidden" name="aid" value="' + obj + '"></span>' + '<span class="editalbum_i_c">' + albumtypebox + '相册名称长度为3到20个字符</span>' + '</div>' + '<div class="clear"></div>' + '</form>',    function() {        var name = $("#editalbumform input[name='name']").val();        var albumtype = $("#editalbumform input[name='albumtype']:checked").val();        if (name.length<3 || name.length>20) {        	$.alert.show("相册名称长度为3到20个字符！");        	return;        }         if(name == ov  && albumtype == atype) {        	$.alert.show("未做修改！");        	return;        }                if (!editwait) {            $.ajax({                beforeSend: function() {                    editwait = true;                    $.prompt.show('正在提交编辑信息......')                },                complete: function() {                    editwait = false;                    $.prompt.hidden()                },                cache: false,                data: {                    'albumId': $('.editalbum_i_b input[name="aid"]').val(),                    'name': $('.editalbum_i_b input[name="name"]').val(),                    'type': albumtype ? albumtype: 0                },                error: function() {                    $.dialog.showMsgLayer('系统异常', '对不起，系统出现异常，相册编辑失败！');                },                success: function(result) {                	var code = result.code;                	if(code == 403) {                		$.dialog.showMsgFuncLayer("登录失效", "登录已失效，请重新登录！",                				function() {                			showSignIn();                		},                		1);                	} else if(code == 400 && result.message=="exist") {               			 $.alert.show('已存在同名相册，请更改名称！');                	} else if(code == 200) {                		$.dialog.showMsgFuncLayer("成功", "修改成功",                				function() {                			window.location.reload()                		},                		1);                	} else {                		$.dialog.showMsgFuncLayer(result.message);                	}                },                type: 'POST',                url: basePath+'album/update'            });        }    });}var delwait = false;function delalbum(obj, dom) {    var num = parseInt($(dom).parents('.album_i_c').find('.album_i_c_a').text());    if (num > 0) $.dialog.showMsgLayer("不能删除", "此相册下还有图片的么，不能删哦！");    else {        var ov = $(dom).parents('.album_i').find('.album_i_b').html().replace(/"/g, '&quot;');        $.dialog.showFuncLayer(430, "确认删除", '确定要删除相册<span class="cog">“' + ov + '”</span>吗？',        function() {            if (!delwait) {                $.ajax({                    beforeSend: function() {                        delwait = true;                        $.prompt.show('正在删除......')                    },                    complete: function() {                        delwait = false;                        $.prompt.hidden()                    },                    cache: false,                    data: {                        'albumId': obj                    },                    error: function() {                        $.dialog.showMsgLayer('系统异常', '对不起，系统出现异常，删除失败！');                    },                    success: function(result) {                    	var code = result.code;                    	if(code == 403) {                    		$.dialog.showMsgFuncLayer("登录失效", "登录已失效，请重新登录！",                    				function() {                    			showSignIn();                    		},                    		1);                    	} else if (code==200) {                            $(dom).parents(".album_i").hide();                            $.dialog.hidden();                        } else if (code = 400) {                        	var message = result.message;                        	if("hasImage"== message) {                        		$.dialog.showMsgLayer("删除失败", "相册内有照片，无法删除！");                        	} else if("one" == message) {                        		$.dialog.showMsgLayer("删除失败", "至少要留一个相册");                        	}                        } else {                            $.dialog.showMsgLayer("删除失败", result.messsage);                        }                    },                    type: 'POST',                    url: basePath+'album/delete'                });            }        });    }}function setalbumlock(type, albumId) {    var setwait = false;    if (type == '1') {        var ov = '设置为<span class="cog">仅自己可见</span>，你确定吗？</span>';    } else {        var ov = '设置为<span class="cog">公开</span>，你确定吗？</span>';    }    $.dialog.showFuncLayer(430, "设置相册属性", ov,    function() {        if (!setwait) {            $.ajax({                beforeSend: function() {                    setwait = true;                    $.prompt.show('操作进行中...')                },                complete: function() {                    setwait = false;                    $.prompt.hidden()                },                cache: false,                data: {                    'albumId': albumId,                    'type': type                },                error: function() {                    $.dialog.showMsgLayer('系统异常', '对不起，系统出现异常，设置失败！');                },                success: function(result) {                    if ("200" == result.code) {                        $.dialog.showMsgFuncLayer("提示", "修改成功",                        function() {                            window.location.reload();                        });                    } else {                        $.dialog.showMsgLayer("提示", result.message);                    }                },                type: 'POST',                url: basePath+'album/publicSet'            });        }    });}